<div 
  class="element-display" 
  [ngClass]="'element-' + item.type"
  draggable="true"
  (dragstart)="onDragStart($event)"
  (dragend)="onDragEnd($event)"
  (dragover)="onDragOver($event)"
  (dragleave)="onDragLeave($event)"
  (drop)="onDrop($event)"
>
  <!-- En-tête avec nom et boutons d'action -->
  <div class="element-header">
    <span class="element-name" *ngIf="!shouldHideHeaderElements()">{{ item.name }}</span>
    <div class="element-actions">
      <button 
        *ngIf="!shouldHideEditButton()"
        class="edit-btn" 
        (click)="editItem()" 
        title="Modifier l'élément"
      >
        ✏️
      </button>
      <button 
        *ngIf="!shouldHideDeleteButton()"
        class="delete-btn" 
        (click)="deleteItem()" 
        title="Supprimer l'élément"
      >
        ×
      </button>
    </div>
  </div>

  <!-- Contenu de l'élément -->
  <div class="element-content">
    
    <!-- Élément textuel -->
    <app-text-element 
      *ngIf="element.type === 'text'"
      [element]="element"
      [canQuickModify]="canQuickModify()"
      (edit)="editItem()"
      (delete)="deleteItem()"
      (valueChange)="onElementValueChange($event)">
    </app-text-element>

    <!-- Élément numérique simple -->
    <app-numeric-element 
      *ngIf="element.type === 'numeric'"
      [element]="element"
      [canQuickModify]="canQuickModify()"
      (edit)="editItem()"
      (delete)="deleteItem()"
      (valueChange)="onElementValueChange($event)">
    </app-numeric-element>

    <!-- Élément select (liste déroulante) -->
    <app-select-element 
      *ngIf="element.type === 'select'"
      [item]="item"
      (valueChange)="onElementValueChange($event)">
    </app-select-element>

    <!-- Attribut D&D -->
    <app-dnd-attribute-element 
      *ngIf="element.type === 'dnd-attribute'"
      [element]="element"
      [canQuickModify]="canQuickModify()"
      (edit)="editItem()"
      (delete)="deleteItem()"
      (valueChange)="onElementValueChange($event)">
    </app-dnd-attribute-element>

    <!-- Groupe d'attributs D&D -->
    <app-dnd-attributes-group 
      *ngIf="element.type === 'dnd-attributes-group'"
      [element]="element"
      [proficiencyBonus]="getCurrentProficiencyBonus()"
      [attr.data-proficiency-bonus]="getCurrentProficiencyBonus()">
    </app-dnd-attributes-group>

    <!-- Bonus de maîtrise D&D -->
    <app-dnd-proficiency-bonus 
      *ngIf="element.type === 'dnd-proficiency-bonus'"
      [element]="element">
    </app-dnd-proficiency-bonus>

    <!-- Niveau D&D -->
    <app-dnd-level 
      *ngIf="element.type === 'dnd-level'"
      [element]="element"
      (valueChange)="onLevelChange($event)">
    </app-dnd-level>

    <!-- Groupe de compétences D&D -->
    <app-dnd-skills-group 
      *ngIf="element.type === 'dnd-skills-group'"
      [element]="element"
      [proficiencyBonus]="getCurrentProficiencyBonus()"
      [attr.data-proficiency-bonus]="getCurrentProficiencyBonus()">
    </app-dnd-skills-group>

    <!-- Équipement -->
    <app-equipment-element 
      *ngIf="element.type === 'equipment'"
      [element]="element"
      [canQuickModify]="canQuickModify()"
      (edit)="editItem()"
      (delete)="deleteItem()"
      (equipToggle)="onEquipmentToggle($event)">
    </app-equipment-element>

    <!-- Points de vie (HP) -->
    <app-hp-element 
      *ngIf="element.type === 'hp'"
      [element]="element"
      [canQuickModify]="canQuickModify()"
      (edit)="editItem()"
      (delete)="deleteItem()"
      (hpChange)="onHpChange($event)">
    </app-hp-element>

    <!-- Attaque -->
    <app-attack-element 
      *ngIf="element.type === 'attack'"
      [element]="element">
    </app-attack-element>

    <!-- Compteur de ressource -->
    <app-resource-counter-element 
      *ngIf="element.type === 'resource-counter'"
      [item]="item"
      (valueChange)="onElementValueChange($event)">
    </app-resource-counter-element>

    <!-- Groupe d'attributs D&D 4e -->
    <app-dnd4e-attributes-group 
      *ngIf="element.type === 'dnd4e-attributes-group'"
      [element]="item"
      (valueChange)="onElementValueChange($event)">
    </app-dnd4e-attributes-group>

    <!-- Voies et Capacités COF2e -->
    <app-cof2e-voies 
      *ngIf="element.type === 'cof2e-voies'"
      [element]="item">
    </app-cof2e-voies>

  </div>

  <!-- Description qui s'affiche au hover -->
  <div class="element-description" *ngIf="item.description" [innerHTML]="item.description | markdown">
  </div>

</div>