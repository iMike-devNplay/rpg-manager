<div class="login-container">
  <div class="login-card">
    <h1>🎲 RPG Manager</h1>
    <p class="subtitle">Gestionnaire de parties de jeu de rôle</p>
    
    <!-- Toggle entre utilisateurs existants et nouveau -->
    <div class="user-mode-toggle">
      <button 
        type="button"
        class="toggle-btn" 
        [class.active]="showExistingUsers"
        (click)="showExistingUsers = true"
      >
        👥 Utilisateurs existants
      </button>
      <button 
        type="button"
        class="toggle-btn" 
        [class.active]="!showExistingUsers"
        (click)="showExistingUsers = false"
      >
        ➕ Nouvel utilisateur
      </button>
    </div>

    <!-- Section utilisateurs existants -->
    <div class="existing-users-section" *ngIf="showExistingUsers">
      <div class="users-list" *ngIf="existingUsers.length > 0; else noUsers">
        <h3>Sélectionnez votre utilisateur :</h3>
        <div class="user-item" 
             *ngFor="let user of existingUsers" 
             [class.selected]="selectedExistingUser?.id === user.id"
             (click)="selectedExistingUser = user">
          <div class="user-info">
            <span class="user-name">{{ user.username }}</span>
            <span class="user-mode" [class]="'mode-' + user.mode">
              {{ getModeLabel(user.mode) }}
            </span>
            <small class="user-date">
              Créé le {{ user.createdAt | date:'dd/MM/yyyy' }}
            </small>
          </div>
          <button 
            type="button"
            class="delete-user-btn" 
            (click)="deleteExistingUser(user, $event)"
            title="Supprimer cet utilisateur"
          >
            🗑️
          </button>
        </div>
        
        <button 
          type="button"
          class="btn-primary connect-existing"
          [disabled]="!selectedExistingUser || isLoading"
          (click)="onSelectExistingUser()"
        >
          <span *ngIf="isLoading">Connexion...</span>
          <span *ngIf="!isLoading">Se connecter</span>
        </button>
      </div>
      
      <ng-template #noUsers>
        <div class="no-users">
          <p>Aucun utilisateur existant trouvé.</p>
          <p>Créez votre premier utilisateur ci-dessous !</p>
          <button type="button" class="btn-secondary" (click)="showExistingUsers = false">
            ➕ Créer un utilisateur
          </button>
        </div>
      </ng-template>
    </div>

    <!-- Section nouveau utilisateur -->
    <form (ngSubmit)="onSubmit()" #loginForm="ngForm" *ngIf="!showExistingUsers">
      <div class="form-group">
        <label for="username">Nom d'utilisateur</label>
        <input 
          type="text" 
          id="username" 
          name="username"
          [(ngModel)]="username" 
          required 
          minlength="2"
          #usernameInput="ngModel"
          class="form-control"
          placeholder="Entrez votre nom d'utilisateur"
        >
        <div class="error-message" *ngIf="usernameInput.invalid && usernameInput.touched">
          Le nom d'utilisateur doit contenir au moins 2 caractères
        </div>
      </div>

      <div class="form-group">
        <label>Mode de jeu</label>
        <div class="mode-selection">
          <label class="mode-option" [class.selected]="selectedMode === userModes.PLAYER">
            <input 
              type="radio" 
              name="mode" 
              [value]="userModes.PLAYER"
              [(ngModel)]="selectedMode"
            >
            <span class="mode-icon">👤</span>
            <span>Joueur</span>
          </label>
          
          <label class="mode-option" [class.selected]="selectedMode === userModes.GAMEMASTER">
            <input 
              type="radio" 
              name="mode" 
              [value]="userModes.GAMEMASTER"
              [(ngModel)]="selectedMode"
            >
            <span class="mode-icon">🎯</span>
            <span>Maître de jeu</span>
          </label>
        </div>
      </div>

      <button 
        type="submit" 
        class="btn-primary"
        [disabled]="loginForm.invalid || isLoading"
      >
        <span *ngIf="isLoading">Création...</span>
        <span *ngIf="!isLoading">Créer et se connecter</span>
      </button>
    </form>

    <div class="info-box">
      <h3>ℹ️ Information</h3>
      <p>Vos données sont stockées localement dans votre navigateur. Aucune information n'est envoyée sur internet.</p>
    </div>
  </div>
</div>